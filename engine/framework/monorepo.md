# Monorepo

## what

Monorepo 是一种项目代码管理方式，指单个仓库中管理多个项目，有助于简化代码共享、版本控制、构建和部署等方面的复杂性，并提供更好的可重用性和协作性。

常用的代码管理模式

![monorepo](/monorepo.webp)

- **单仓库巨石应用** 随着迭代业务复杂度的提升，项目代码越来越多，越来越复杂，代码量过大，导致构建效率也会降低，最终导致了单体巨石应用，这种代码管理方式称之为 Monolith。

- **多仓库多模块应用** 将巨石项目拆解成多个业务模块，并在多个 Git 仓库管理，模块解耦，降低了巨石应用的复杂度，每个模块都可以独立编码、测试、发版，代码管理变得简化，构建效率也得以提升，这种代码管理方式称之为 MultiRepo。

  ::: tip 优点

  1. 代码隔离，研发者只需关注自己负责的仓库
  2. 各项目单独仓库，不会出现代码被误改的情况，单个项目出现问题不会影响其他项目。各项目单独仓库，不会出现代码被误改的情况，单个项目出现问题不会影响其他项目。
  3. 仓库体积小，模块划分清晰，可维护性强。

  :::

  ::: warning 缺点

  1. 仓库过多，开发过程中项目建来回切换导致错误，磁盘内存占用大。
  2. 仓库之间存在依赖，需要手动 link，操作繁琐
  3. 项目依赖管理不变，各仓库中存在不同版本依赖库
  4. 各项目构建、打包等基础配置各自维护，不一致时可能导致代码差异或构建差异；eg: eslint 配置不一致，编辑器报错问题

  :::

- **当仓库多模块** 将多个项目集成到一个仓库下，共享工程配置，同时又快捷地共享模块代码，成为趋势，这种代码管理方式称之为 MonoRepo。

  ::: tip 优点

  1. 一个仓库中多个相关项目，很容易看到整个代码库的变化趋势，更好的团队协作。
  2. 多项目代码都在一个仓库中，相同版本依赖提升到顶层只安装一次，节省磁盘内存。
  3. 代码复用高，方便进行代码重构。
  4. 依赖调试方便，依赖模块有个更新，只需刷新页面
  5. 多项目在一个仓库，工程配置一致，代码质量标准及风格也很容易一致。
  6. 构建配置一致，只需微调打包命令

  :::

  ::: warning 缺点

  1. 权限问题，没有项目粒度的权限管控
  2. 仓库代码量过大
  3. Git 记录混乱

  :::

## MultiRepo 和 Monorepo 对比

1. 依赖安装

| Action           |   MultiRepo    | Monorepo |  Monorepo 收益 & 缺点 |
| ---------------- | :------------: | -------: | --------------------: |
| install 依赖次数 | 项目个数即次数 |     一次 | 减少 install 命令次数 |

2. 本地调试

![开发](/develop.png)

3. CI 构建

4. 发布与上线

## when

## how
